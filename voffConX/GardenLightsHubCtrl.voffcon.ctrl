{"name":"GardenLightsHubCtrl","description":"Displays gardenlight throughout the garden\n\nEsp32 used as a hub and esp32 uses Nrf24L01 to send commands to reomote.\n\nDeviceServerEsp32FloodlightController.ino is urrning on esp32\nand SpotlightIRemoteController.ino is running on the nanos.\n","code":"\"use strict\";\r\n/*\r\nUse this control to turn a pin value off or on.\r\nThis control will display a iphone-like switch which\r\nthe user can click on to turn the pin on or off. \r\n*/\r\n\r\nvar GardenLightsHubCtrlExtender = 0;\r\nclass GardenLightsOldCtrl extends ControlElement {\r\n\r\n\tconstructor(left, top, nodeArray, onButtonClickCallback, onButtonClickErrorCallback){\r\n\t        \r\n\t\tsuper('garden-lights-hub-ctrl', ++GardenLightsHubCtrlExtender, left, top);\r\n\r\n\t\tthis.addNode(nodeArray);\r\n\t\tthis.init(onButtonClickCallback, onButtonClickErrorCallback);\r\n\t\tthis.remoteTextClear();\r\n\t}\r\n\t\r\n\t/*\r\n\t*\r\n    * Adds success or error text on the remote \r\n    *\r\n    * @param {String} upper   -  If 'up',  text at top    of remote is set. \r\n    *                            If 'down' text at bottom of remote is set.\r\n    *\r\n    * @param {Boolean} success - If true green success text is displayed for a \r\n    *                            short while.  If false, red text is displayed.\r\n    * @param {String} text     - the text to display.\r\n    */ \r\n\tremoteTextSet(upper, success, text) {\r\n   \t    var $elm;\r\n\t    if (upper === undefined) {\r\n\t        $elm = $('.remote.container .text');\r\n\t    } else {\r\n\t        $elm = $(`.remote.container .text.${upper}`);\r\n\t    }\r\n\t    var classToAdd = 'error';\r\n\t    if (success) { \r\n\t        classToAdd = 'success'; \r\n\t    }\r\n\t    $elm.removeClass('success error').addClass(classToAdd).text(text);\r\n\t}\r\n\t\r\n\t/*\r\n    * Clears text on the remote \r\n    *\r\n    * @param {String} upper   -  If 'up',  text at top    of remote is cleared. \r\n    *                            If 'down' text at bottom of remote is cleared.\r\n    *                            If 'undefined' all remote text is cleared.\r\n    *\r\n    */\r\n\tremoteTextClear(upper) {\r\n\t    var $elm;\r\n\t    if (upper === undefined) {\r\n\t        $elm = $('.remote.container .text');\r\n\t    } else {\r\n\t        $elm = $(`.remote.container .text.${upper}`);\r\n\t    }\r\n\r\n        $elm.text('');\r\n\t}\r\n\t\r\n\tinit(onButtonClickCallback, onButtonClickErrorCallback) {\r\n\t    \r\n\t    var that = this;\r\n\t    \r\n\t    $('div.node-container div.node').on( 'click tap', function() {\r\n\t        if ($( this ).hasClass('node-selected')) {\r\n\t            $( this ).removeClass('node-selected');\r\n\t        } else {\r\n\t            var elm = $(this);\r\n\t            if (elm.is('.selectable','.node-selected')) {\r\n\t                elm.addClass('node-selected');\r\n\t            }\r\n\t        }\r\n            \r\n        });\r\n        \r\n        this.getButtons().on( \"click\", function() {\r\n            \r\n            var pin = 32;\r\n            var command = $( this ).data('command');\r\n            var addresses = [];\r\n\r\n            that.getNodes().each(function( index ) {\r\n                var id = $( this ).attr('id');\r\n                addresses.push(parseInt(id.substr(5),8));\r\n            });\r\n\r\n    \t\tvar sendObj = { command:Number(command), addresses: addresses};\r\n    \t\t\r\n            var url = getServer()+'/devices/custom/'+ deviceId;\r\n            that.remoteTextClear();\r\n        \tvar posting = $.post( url, sendObj);\r\n        \tconsole.log(sendObj)\r\n        \tposting.\r\n            \tdone(function(data, textSuccess, responceObject) {\r\n            \t    that.remoteTextSet('up', true, `${that.getCommandText(command)} sent`);\r\n            \t    if (onButtonClickCallback !== undefined) {\r\n            \t        var ret = data;\r\n            \t        if (data.result !== undefined) {\r\n            \t            ret = data.result;\r\n            \t        }\r\n            \t        return onButtonClickCallback(ret);\r\n            \t    }\r\n            \t    \r\n        \t   \r\n            \t}).\r\n            \tfail(function(data, textError, responceObject) {\r\n            \t\t\tthat.remoteTextSet('up', false, `Failed sending \"${that.getCommandText(command)}\" to all nodes`);\r\n            \t\t\tif (data.responseJSON !== undefined && data.responseJSON.result !== undefined) {\r\n            \t\t\t    if (onButtonClickErrorCallback !== undefined) {\r\n            \t\t\t        var ret = data.responseJSON.result;\r\n\r\n            \t\t\t        if ( ret.node_results !== undefined && ret.node_results.length > 0) {\r\n            \t\t\t             var errorText = \"\";\r\n                \t\t\t         ret.node_results.forEach(function(item, index) {\r\n                    \t\t\t         if (item.code === 400) {\r\n                    \t\t\t             var address = parseInt(item.address,8);\r\n                    \t\t\t             console.log(\"Error sending to node: \"+ address );\r\n                    \t\t\t             errorText+= errorText.length > 0 ? `, 0${address}` : `0${address}`;\r\n                    \t\t\t         }\r\n                \t\t\t        });\r\n                \t\t\t        that.remoteTextSet('down', false, `Nodes: ${errorText}`);\r\n            \t\t\t        }\r\n            \t\t\t        \r\n            \t                return onButtonClickErrorCallback(ret);\r\n            \t\t\t    }\r\n            \t\t\t}\r\n            \t\t\t\r\n            \t\t\tif (onButtonClickErrorCallback !== undefined) {\r\n            \t            onButtonClickErrorCallback(data);\r\n            \t        }\r\n        \t\t});\r\n        });\r\n\t}\r\n\t\r\n\taddNode(nodeArray){\r\n\t   \r\n        var container = this.getNodeContainer();\r\n        \r\n        container.empty();\r\n       \r\n        $.each(nodeArray, function(key, value) {\r\n             if (value.selectable === undefined) {\r\n                 value.selectable = true; //default\r\n             }\r\n             \r\n             var str, strClass='selectable node-selected';\r\n             if (key === 'background') { \r\n                 strClass = \"background\";\r\n             } else if (value.selectable === false) {\r\n                 strClass = \"\";\r\n             }\r\n             \r\n             str= '<div id=\"node-'+key+'\" class=\"node '+strClass+'\">';\r\n             if (key !=='background') {\r\n                 str+='<p>'+key+'</p>';\r\n             }\r\n             \r\n             str+='</div>';\r\n             \r\n            container.append(str)\r\n              \r\n            $('#node-'+key).css({\r\n                    background:'url(\"'+value.imageUrl+'\") no-repeat',\r\n                    \"background-size\":\"contain\",\r\n                    position: \"absolute\",\r\n                    width:value.width,\r\n                    height:value.height,\r\n                    left:value.left-50,\r\n                    top:value.top-100\r\n                    \r\n                });\r\n        });\r\n    }\r\n\t\r\n    getId()      { return super.getId();}\r\n\tgetButtons() { return $('#' + this.getId() + '> div.remote.container button'); }\r\n\tgetButtonFromCommand(command) { return $(`#${this.getId()}> div.remote.container button[data-command=${command}]` ); }\r\n\tgetCommandText(command) { \r\n\t    var classArray = this.getButtonFromCommand(command).attr(\"class\").split(/\\s+/);\r\n\t    const result = classArray.filter(word => word.indexOf(\"remote-\") > -1);\r\n\t    return result[0].substr(7).toUpperCase();\r\n\t    \r\n\t}\r\n\tgetNodes()   { return $('#' + this.getId() + ' .node-container .node.node-selected'); }\r\n\t\r\n\tgetNodeContainer() { return $('#' + this.getId() + ' div.node-container'); }\r\n\tgetValue()   { return  this.getSelect().val();}\r\n\t\r\n\t\r\n\t\r\n\tactive(bActivate){\r\n\t    // todo: having problems with enabling again. so disabling this function for now\r\n\t    return;    \r\n\r\n        var domElm = this.getSelect().get(0);\r\n        console.log(\"dom\" + domElm);\r\n        domElm.disabled=!bActivate;\r\n\t}\r\n\t\r\n\tscale(value){\r\n\t\tsuper.scale(this.getSelect(), value);\r\n\t}\r\n\trotate(degrees){\r\n\r\n\t\tsuper.rotate(this.getSelect(), degrees);\r\n\t}\r\n\r\n\t\r\n\tsetValue(value){\r\n\t    console.log(\"setting value to \" + value);\r\n\t\tvar str = value.toString();\r\n\t\tthis.getSelect().val(str);\r\n\t}\r\n\t\r\n\tregisterClick(callback){\r\n\t\tvar obj = {that:this};\r\n\t\tif (callback !== undefined){\r\n\t\t\tobj['callback'] = callback;\r\n\t\t}\r\n\t\tthis.getSelect().on( \"change\", obj, this.onChange );\r\n\t\t\r\n\t}\r\n\r\n}//class\r\n","helpurl":"https://guttih.com/projects/garden-lights#step9","template":"<div id=\"garden-lights-hub-ctrl\" style=\"position:absolute\">\r\n    \r\n    <div class=\"remote back\">\r\n       \r\n   </div>\r\n   <div class=\"remote container\">\r\n       <div class=\"button-container\">\r\n           <span class=\"text up\">uppi</span>\r\n           <div class=\"group updown\"></div>\r\n           <div class=\"group offon\"></div>\r\n           <div class=\"group colors1\"></div>\r\n           <div class=\"group colors2\"></div>\r\n           <div class=\"group colors3\"></div>\r\n           <div class=\"group programs\"></div>\r\n            <div class=\"row\">\r\n                <button data-command=\"0\" type=\"button\" class=\"remote-up   btn btn-default btn-sm\"><span class=\"glyphicon glyphicon-triangle-top\"></span></button>\r\n                <button data-command=\"1\" type=\"button\" class=\"remote-down btn btn-default btn-sm\"><span class=\"glyphicon glyphicon-triangle-bottom\"></span></button>\r\n                <button data-command=\"2\"  type=\"button\" class=\"remote-off btn btn-default btn-sm font-big\">OFF</button>\r\n                <button data-command=\"3\"  type=\"button\" class=\"remote-on btn btn-default btn-sm font-big\">ON</button>\r\n            </div>\r\n            <div class=\"row\">\r\n                <button data-command=\"4\"  type=\"button\" class=\"remote-red   btn btn-default btn-sm font-big one-letter\">R</button>\r\n                <button data-command=\"5\"  type=\"button\" class=\"remote-green btn btn-default btn-sm font-big one-letter\">G</button>\r\n                <button data-command=\"6\"  type=\"button\" class=\"remote-blue  btn btn-default btn-sm font-big one-letter\">B</button>\r\n                <button data-command=\"7\"  type=\"button\" class=\"remote-white btn btn-default btn-sm font-big one-letter\">W</button>\r\n            </div>\r\n            <div class=\"row\">\r\n                <button data-command=\"8\"  type=\"button\" class=\"remote-red-light    btn btn-default btn-sm\" style=\"background:#f93030\"></button>\r\n                <button data-command=\"9\"  type=\"button\" class=\"remote-green-light  btn btn-default btn-sm\" style=\"background:#00802d\"></button>\r\n                <button data-command=\"10\"  type=\"button\" class=\"remote-purple       btn btn-default btn-sm\" style=\"background:#4f0080\"></button>\r\n                <button data-command=\"11\"  type=\"button\" class=\"remote-flash    btn btn-default btn-sm font-small\">FLASH</button>\r\n            </div>\r\n            <div class=\"row\">\r\n                <button data-command=\"12\"  type=\"button\" class=\"remote-orange       btn btn-default btn-sm\" style=\"background:orange\"></button>\r\n                <button data-command=\"13\"  type=\"button\" class=\"remote-green-cyan   btn btn-default btn-sm\" style=\"background:#00ffb8\"></button>\r\n                <button data-command=\"14\"  type=\"button\" class=\"remote-purple-pink  btn btn-default btn-sm\" style=\"background:purple\"></button>\r\n                <button data-command=\"15\"  type=\"button\" class=\"remote-strobe   btn btn-default btn-sm font-small\">STROBE</button>\r\n            </div>\r\n             <div class=\"row\">\r\n                <button data-command=\"16\"  type=\"button\" class=\"remote-orange-light btn btn-default btn-sm\" style=\"background:orange\"></button>\r\n                <button data-command=\"17\"  type=\"button\" class=\"remote-cyan         btn btn-default btn-sm\" style=\"background:cyan\"></button>\r\n                <button data-command=\"18\"  type=\"button\" class=\"remote-pink         btn btn-default btn-sm\" style=\"background:#ad00ad\"></button>\r\n                <button data-command=\"19\"  type=\"button\" class=\"remote-fade     btn btn-default btn-sm font-small\">FADE</button>\r\n            </div>\r\n            <div class=\"row\">\r\n                <button data-command=\"20\"  type=\"button\" class=\"remote-yellow       btn btn-default btn-sm\" style=\"background:yellow\"></button>\r\n                <button data-command=\"21\"  type=\"button\" class=\"remote-cyan-green   btn btn-default btn-sm\" style=\"background:#00adff\"></button>\r\n                <button data-command=\"22\"  type=\"button\" class=\"remote-pink         btn btn-default btn-sm\" style=\"background:#f90280\"></button>\r\n                <button data-command=\"23\"  type=\"button\" class=\"remote-smooth       btn btn-default btn-sm font-small\">SMOOTH</button>\r\n            </div>\r\n            <div class=\"row\">\r\n                <button data-command=\"24\"  type=\"button\" class=\"remote-ff btn btn-default btn-sm font-big two-letters\">FF</button>\r\n                \r\n            </div>\r\n           \r\n            <span class=\"text down error\">error sending to </span>\r\n            \r\n        </div>\r\n       \r\n   </div>\r\n    <div class=\"node-container\">\r\n        \r\n    </div>\r\n    \r\n\r\n    \r\n   \r\n</div> <!--select-->\r\n\r\n<style>\r\n\r\n.remote.container .text {\r\n    position: absolute;\r\n    font-size:12px;\r\n\r\n}\r\n\r\n.remote.container .text.success{\r\n    color:green;\r\n}\r\n.remote.container .text.error{\r\n    color:red;\r\n    font-size:10px;\r\n    line-height: 0.9;\r\n}\r\n\r\n.remote.container .text.up {\r\n    \r\n    top: 1px;\r\n    left:7px;\r\n}\r\n.remote.container .text.down {\r\n    top: 222px;\r\n    left: 36px;\r\n}\r\n\r\n.remote {\r\n    height: 250px;\r\n    width: 155px;\r\n    background: whitesmoke;\r\n    position: absolute;\r\n    left: 470px;\r\n    top:-100px;\r\n    z-index: 2;\r\n    border-radius:8px;\r\n    border-color:black;\r\n    border: 3px solid black;\r\n}\r\n.remote.back {\r\n    background: black;\r\n    left: 467px;\r\n    top:-97px;\r\n}\r\n\r\n.remote.container .button-container{\r\n    padding-top:20px;    \r\n}\r\n\r\n.remote .group {\r\n    position:absolute;\r\n    background:lightgray;\r\n    border-radius:5px;\r\n    z-index:-1;\r\n}\r\n\r\n.remote .group.updown {\r\n    left: 3px;\r\n    top: 25px;\r\n    width: 68px;\r\n    height: 30px;\r\n    \r\n}\r\n.remote .group.offon {\r\n    left: 77px;\r\n    top: 25px;\r\n    width: 70px;\r\n    height: 30px;\r\n}\r\n\r\n.remote .group.colors1 {\r\n    left: 3px;\r\n    top: 57px;\r\n    width: 144px;\r\n    height: 29px;\r\n    border-radius:5px 5px 5px 0px;\r\n}\r\n.remote .group.colors2 {\r\n    left: 3px;\r\n    top: 86px;\r\n    width: 111px;\r\n    height: 128px;\r\n    border-radius:0px 0px 5px 5px;\r\n}\r\n.remote .group.colors3 {\r\n    left: 100px;\r\n    top: 80px;\r\n    width: 20px;\r\n    height: 20px;\r\n    border-radius:0px;\r\n}\r\n.remote .group.programs {\r\n    left: 114px;\r\n    top: 86px;\r\n    width: 34px;\r\n    height: 120px;\r\n    background: whitesmoke;\r\n}\r\n\r\n\r\n.remote.container .row{\r\n    padding-top:10px;    \r\n    padding-left:5px;    \r\n}\r\n\r\n.remote.container .row {\r\n    padding-top:7px;    \r\n    padding-left:5px;    \r\n}\r\n\r\n.remote.container button{\r\n     height: 25px;\r\n     width: 25px;\r\n     padding-left: 6px;\r\n     padding-top: 4px;\r\n     margin-right:9px;\r\n     border-radius:12px;\r\n}\r\n\r\n.remote.container div.row button:last-child {\r\n    margin-right:0px;\r\n}\r\n\r\n.remote.container .font-big{\r\n     padding-top: 6px;\r\n     padding-left:3px;\r\n     font-size: 9px;\r\n}\r\n.remote.container .font-small{\r\n     padding-top: 6px;\r\n     padding-left:0px;\r\n     font-size: 5px;\r\n}\r\n.remote.container .remote-flash{\r\n     padding-left:3px;\r\n}\r\n.remote.container .remote-strobe{\r\n     padding-left:1px;\r\n}\r\n.remote.container .remote-fade{\r\n     padding-left:5px;\r\n}\r\n.remote.container .font-big.one-letter{\r\n     padding-right:0px;\r\n     padding-left:0px;\r\n}\r\n.remote.container .font-big.two-letters{\r\n     padding-right:2px;\r\n}\r\n\r\n.remote.container .font-big.remote-off{\r\n     padding-left:3px;\r\n     background:black;\r\n     color:white;\r\n}\r\n.remote.container .font-big.remote-on{\r\n     padding-left:4px;\r\n     background:red;\r\n     color:white;\r\n}\r\n.remote.container .font-big.remote-red{\r\n     background:red;\r\n     color:white;\r\n}\r\n\r\n.remote.container .font-big.remote-green{\r\n     background:green;\r\n     color:white;\r\n}\r\n.remote.container .font-big.remote-blue{\r\n     background:blue;\r\n     color:white;\r\n}\r\n.remote.container .font-big.remote-white{\r\n     background:white;\r\n}\r\n\r\ndiv.node-container div.node > p{\r\n    text-align:center;\r\n    font-weight: 600;\r\n    color:#adadad;\r\n    margin-top:-20px;\r\n}\r\n\r\ndiv.node-container div.node.node-selected > p {\r\n    color:red;\r\n}\r\ndiv.node-container div.node{\r\n    border: 1px solid #353535;\r\n    border-radius:8px;\r\n}\r\n\r\ndiv.node-container div.node.background{\r\n    z-index:-1;\r\n}\r\n\r\n\r\n\r\ndiv.node-container div.node.node-selected {\r\n     border: 1px solid red;\r\n}\r\nselect.form-control {\r\n    margin-top: 114px;\r\n    margin-left: 58px;\r\n    \r\n}\r\nbutton.form-control {\r\n    margin-top: 5px;\r\n    margin-left: 58px;\r\n    \r\n}\r\n.footer {\r\n    margin-top:200px;\r\n    padding-top: 19px;\r\n    color: #777;\r\n    border-top: 1px solid #e5e5e5;\r\n}\r\n\r\n\r\n</style>","active":true}